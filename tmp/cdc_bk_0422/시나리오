CDC 연동 테스트 시나리오

1) UDF (stg -> target 검증)

1-1. DDL 생성

/home/gpadmin/pivotal/cdc/cdc_template/ddl_template.sql

public.template_src
public.template_target -> template
public.template_stg 


1-2. UDF Generation
sh gen_udf.sh public.tempalte_src



1-3. 테스트
src, stg, udf 
gen_template_src_1.sql
gen_template_stg_1.sql
select ${UDF_NAME}

src, stg, target 조회해서 source=target, stage = 0 -> complete 
2~5 반복 -> udf 검증완료 

-- json sample 생성 
json_template_stg_1.json ~ 5
[] 추가 
{ "id": 1, ~~ "cud_fg": "I" }
[{ "id": 1, ~~ "cud_fg": "I" }]

3. kafka 연동

kafka node 
-- topic 생성 
on kafka 03 
cdc_test $ cat create_topic.sh 

/usr/local/kafka/bin/kafka-topics.sh --create --topic jstemplate --bootstrap-server localhost:9020 --replication-factor 1 --partitions 1

topic : jstemplate 

-- topic 확인
cat list_topic.sh 

-- topic에 데이터 생성 
$ cat gen_kakfa_data.sh 

--topic jstemplate < json_template_stg_${i}.json

-- data 확인 
cat show_kafka_data.sh  

gpss 기동 
기동할 때 config port 50007 뺐다. 빼면 디폴트로 
너저분해서 

토픽을 바라볼 수 있는 job 생성 (gpss가 주체)
필요한것이 yml
yml udf 등록

yaml의 expressiong 생성해, 리턴해주는 값을 포맷팅해주는 펑션 
--> function.sql 

-> gen_yaml.sh 
sh gen_yaml.sh jstemplate public.template 
--> yaml 생성 

이거가지고 
gpss job 생성 
striim$ cat submit_kafka_load.sh 
gpsscli submit --name $1 $2 
topic yaml 


목록 
cat list_kafka_load.sh 

실행 
start_kafka_load.sh 
$1 jstemplate 
--force-reset-latest 
offset 무시하고 가장 마지막부터 대기 ...

--forece-reset-ealiest ...


목록 
cat list_kafka_load.sh 
tail -f gpss_20200414.log | grep "Start batch"

gpsscli list --all
여기까지 준비완료 


- topic 에 데이터 생성 
$ cat gen_kafka_data.sh
-- topic jstemplate < json_template_stg_${i}.json


